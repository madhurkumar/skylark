<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Skylark by quantarray</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/main.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>

      <header>
        <h1>Skylark</h1>
        <p></p>
      </header>

      <div id="banner">
        <span id="logo"></span>

        <a href="https://github.com/quantarray/skylark" class="button fork"><strong>View On GitHub</strong></a>
        <div class="downloads">
          <span>Downloads:</span>
          <ul>
            <li><a href="https://github.com/quantarray/skylark/zipball/master" class="button">ZIP</a></li>
            <li><a href="https://github.com/quantarray/skylark/tarball/master" class="button">TAR</a></li>
          </ul>
        </div>
      </div><!-- end banner -->

    <div class="wrapper">
      <nav>
        <ul></ul>
      </nav>
      <section>
        <h1>
<a id="skylark" class="anchor" href="#skylark" aria-hidden="true"><span class="octicon octicon-link"></span></a>Skylark</h1>

<p>Skylark is a set of libraries for quantitative and financial computation.</p>

<h2>
<a id="skylark-measure" class="anchor" href="#skylark-measure" aria-hidden="true"><span class="octicon octicon-link"></span></a>skylark-measure</h2>

<p><strong>skylark-measure</strong> is a library dealing with unit-of-measure conversions in a type-safe manner. Many libraries provide similar functionality on 
their surface but in the end lack the richness and versatility necessary to use in real enterprise applications.</p>

<p>Many units of measure are defined for you.</p>

<div class="highlight highlight-scala"><pre>kg
lb
<span class="pl-en">Pa</span>
<span class="pl-en">Hz</span></pre></div>

<p>Any unit of measure will have a set of basic properties that you would naturally expect to interrogate.</p>

<div class="highlight highlight-scala"><pre>kg.name should be(<span class="pl-s"><span class="pl-pds">"</span>kg<span class="pl-pds">"</span></span>)
kg.dimension should be(<span class="pl-en">Mass</span>)
kg.system should be(<span class="pl-en">SI</span>)
kg.multBase.value should be((<span class="pl-c1">1000</span>, g)) <span class="pl-c">// Gram is a base unit of Mass in the SI system</span></pre></div>

<p>You can take existing units and compose more complex ones by multiplying, dividing, and exponentiating.</p>

<div class="highlight highlight-scala"><pre>kg <span class="pl-k">*</span> m <span class="pl-k">/</span> sec ^ <span class="pl-c1">2</span></pre></div>

<p>You can find our the conversion factor from one <em>to</em> another.  No conversion factor may exist.</p>

<div class="highlight highlight-scala"><pre>(kg to lb).value should be(<span class="pl-c1">2.204625</span>)</pre></div>

<p>You can attach substances (or, in general, assets) to units of measure to distinguish substances of different quality or composition, 
which can impact the conversion factor. For example, <a href="http://en.wikipedia.org/wiki/West_Texas_Intermediate">West Texas Intermediate</a> (WTI) barrel of 
oil has a different conversion factor to gallons than a barrel of water.</p>

<div class="highlight highlight-scala"><pre>(bbl to gal).value should equal(<span class="pl-c1">31.5</span>)
(bbl of wti to gal).value should equal(<span class="pl-c1">42</span>)</pre></div>

<p>Conversions are done though <code>implicit</code> <em>ConversionProviders</em>. The default <em>ConversionProviders</em> should suffice for most needs but you can roll your own at any time.</p>

<p>Too many systems omit units of measure when storing or presenting numerical quantities. Now you can store units of measure along with a numeric value as a plain string.
With <code>MeasureParsers</code> you can turn that string back into a measure.</p>

<div class="highlight highlight-scala"><pre>parseAll(measureExpression, <span class="pl-s"><span class="pl-pds">"</span>USD / bbl<span class="pl-pds">"</span></span>).get should be(<span class="pl-en">USD</span> <span class="pl-k">/</span> bbl)
parseAll(measureExpression, <span class="pl-s"><span class="pl-pds">"</span>((USD * (MMBtu / bbl) ^ 3) ^ 2) / MMBtu<span class="pl-pds">"</span></span>).get should be(((<span class="pl-en">USD</span> <span class="pl-k">*</span> ((<span class="pl-en">MMBtu</span> <span class="pl-k">/</span> bbl) ^ <span class="pl-c1">3</span>)) ^ <span class="pl-c1">2</span>) <span class="pl-k">/</span> <span class="pl-en">MMBtu</span>)</pre></div>

<p>It's easy to compose numerical quantities with units of measure using a dot or postfix syntax. If the unit is structurally more complex than a single word, then
use the <code>*</code> syntax.</p>

<div class="highlight highlight-scala"><pre><span class="pl-c1">10.</span>kg
<span class="pl-c1">4</span> m
<span class="pl-c1">1000</span> <span class="pl-k">*</span> (bbl of wti)</pre></div>

<p>You can perform the expected arithmetic operations on quantities.</p>

<div class="highlight highlight-scala"><pre><span class="pl-c1">10.</span>kg <span class="pl-k">*</span> <span class="pl-c1">5</span> should be(<span class="pl-c1">50.</span>kg)
<span class="pl-c1">10</span> <span class="pl-k">*</span> (kg of cotton)) <span class="pl-k">*</span> <span class="pl-c1">5</span> should be(<span class="pl-c1">50</span> <span class="pl-k">*</span> (kg of cotton))
<span class="pl-c1">10.</span>kg <span class="pl-k">*</span> <span class="pl-c1">4.</span>m should be(<span class="pl-c1">40</span> <span class="pl-k">*</span> (kg <span class="pl-k">*</span> m))</pre></div>

<p>Arithmetic on different units may result in raw unit representation that may not be desirable. You may compact it as necessary.</p>

<div class="highlight highlight-scala"><pre><span class="pl-k">val</span> <span class="pl-en">potOfGold</span> <span class="pl-k">=</span> <span class="pl-c1">30000.</span><span class="pl-en">USD</span>
<span class="pl-k">val</span> <span class="pl-en">rate</span> <span class="pl-k">=</span> <span class="pl-c1">5.</span>percent
<span class="pl-k">val</span> <span class="pl-en">panOfGold</span> <span class="pl-k">=</span> potOfGold <span class="pl-k">*</span> rate
panOfGold should equal(<span class="pl-c1">1500</span> <span class="pl-k">*</span> (<span class="pl-en">USD</span> <span class="pl-k">*</span> <span class="pl-en">UnitMeasure</span>))
panOfGold.measure.compact should equal(<span class="pl-en">USD</span>)</pre></div>

<p>Quantity conversions are also supported via the same <code>to</code> operator.</p>

<div class="highlight highlight-scala"><pre>((<span class="pl-c1">10</span> kg) to lb) should be(<span class="pl-c1">22.04625</span> lb)
<span class="pl-c1">50</span> bp to percent should be(<span class="pl-c1">0.5</span>.percent)</pre></div>

<p>Even when measures have non-trivial structural complexity, quantity conversions work as expected.</p>

<div class="highlight highlight-scala"><pre><span class="pl-k">val</span> <span class="pl-en">rhoPercent</span> <span class="pl-k">=</span> <span class="pl-c1">2.5</span> <span class="pl-k">*</span> ((<span class="pl-en">USD</span> <span class="pl-k">/</span> <span class="pl-en">MMBtu</span>) <span class="pl-k">/</span> percent)
<span class="pl-k">val</span> <span class="pl-en">rhoBasisPoint</span> <span class="pl-k">=</span> rhoPercent to ((<span class="pl-en">USD</span> <span class="pl-k">/</span> <span class="pl-en">MMBtu</span>) <span class="pl-k">/</span> bp)
rhoBasisPoint should equal(<span class="pl-c1">0.025</span> <span class="pl-k">*</span> ((<span class="pl-en">USD</span> <span class="pl-k">/</span> <span class="pl-en">MMBtu</span>) <span class="pl-k">/</span> bp))</pre></div>

<h2>
<a id="skylark-measure-market" class="anchor" href="#skylark-measure-market" aria-hidden="true"><span class="octicon octicon-link"></span></a>skylark-measure-market</h2>

<p><strong>skylark-measure-market</strong> is a library that extends <strong>skylark-measure</strong> to the financial domain, where unit conversion factors are not fixed 
and normally vary as a function of time or space or both. For example, the conversion factor from US Dollars (<code>USD</code>) to Japanese Yen (<code>JPY</code>) will
depend on the observed time; similarly, a tanker of oil at two different locations around the globe will be worth a 
different quantity of dollars, even when controlling for the currency exchange rate between the two locations.</p>

<p>You can control the variability of a particular unit of measure with respect to another (e.g. how does <code>bbl of WTI</code> vary with respect to <code>USD</code>, otherwise known as a price)
by constructing a market manifold, which is a fancy name for a curve or a surface. In general, a market manifold is a function; in can be discrete or continuous and can
give you a value given a key.</p>

<p>In finance, a forward curve carries a price - a value of something vs. something else (e.g. <code>bbl of wti / USD</code> or <code>USD / GBP</code>).</p>

<div class="highlight highlight-scala"><pre><span class="pl-k">val</span> <span class="pl-en">wtiForwardCurve</span> <span class="pl-k">=</span> <span class="pl-en">DiscreteForwardCurve</span>(<span class="pl-en">USD</span> <span class="pl-k">/</span> (bbl of wti), <span class="pl-en">Seq</span>((<span class="pl-s"><span class="pl-pds">"</span>2014-04-01<span class="pl-pds">"</span></span>.d, <span class="pl-c1">100.0</span>), (<span class="pl-s"><span class="pl-pds">"</span>2017-01-01<span class="pl-pds">"</span></span>.d, <span class="pl-c1">150.0</span>)))</pre></div>

<p>You can combine multiple manifolds into a <code>Market</code>, which is a special kind of a bag carrying all data relevant to a given observation date/time.</p>

<div class="highlight highlight-scala"><pre><span class="pl-k">val</span> <span class="pl-en">observationDate</span><span class="pl-k">:</span> <span class="pl-en">DateTime</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>2014-04-01<span class="pl-pds">"</span></span>.d
<span class="pl-k">val</span> <span class="pl-en">market</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">GlobalMarket</span>(
    <span class="pl-en">Seq</span>(
      <span class="pl-en">TimeInstantCurve</span>(observationDate),
      <span class="pl-en">DiscreteForwardCurve</span>(<span class="pl-en">USD</span> <span class="pl-k">/</span> (bbl of wti), <span class="pl-en">Seq</span>((<span class="pl-s"><span class="pl-pds">"</span>2014-04-01<span class="pl-pds">"</span></span>.d, <span class="pl-c1">100.0</span>), (<span class="pl-s"><span class="pl-pds">"</span>2017-01-01<span class="pl-pds">"</span></span>.d, <span class="pl-c1">150.0</span>))),
      <span class="pl-en">DiscreteForwardCurve</span>.flat(<span class="pl-c1">1.2</span> <span class="pl-k">*</span> (<span class="pl-en">CAD</span> <span class="pl-k">/</span> <span class="pl-en">USD</span>), observationDate.until(<span class="pl-s"><span class="pl-pds">"</span>2018-01-01<span class="pl-pds">"</span></span>.d).by(<span class="pl-en">Days</span>.<span class="pl-en">ONE</span>)),
      <span class="pl-en">DiscreteForwardCurve</span>.flat(<span class="pl-c1">120</span> <span class="pl-k">*</span> (<span class="pl-en">CAD</span> <span class="pl-k">/</span> <span class="pl-en">JPY</span>), observationDate.until(<span class="pl-s"><span class="pl-pds">"</span>2018-01-01<span class="pl-pds">"</span></span>.d).by(<span class="pl-en">Days</span>.<span class="pl-en">ONE</span>)),
      <span class="pl-en">DiscreteForwardCurve</span>.flat(<span class="pl-c1">100</span> <span class="pl-k">*</span> (<span class="pl-en">USD</span> <span class="pl-k">/</span> <span class="pl-en">JPY</span>), observationDate.until(<span class="pl-s"><span class="pl-pds">"</span>2018-01-01<span class="pl-pds">"</span></span>.d).by(<span class="pl-en">Days</span>.<span class="pl-en">ONE</span>))
    )
  )</pre></div>

<p>Note that <code>observationDate</code> is attached to the <code>Market</code> via a special <code>TimeInstantCurve</code> instead of making it a special property of the <code>Market</code>.</p>

<p>With the above assembled, you can do a lot of neat stuff.</p>

<div class="highlight highlight-scala"><pre><span class="pl-k">val</span> <span class="pl-en">barrelPrice</span> <span class="pl-k">=</span> <span class="pl-c1">42</span> <span class="pl-k">*</span> (<span class="pl-en">USD</span> <span class="pl-k">/</span> (bbl of wti))
<span class="pl-k">val</span> <span class="pl-en">gallonPrice</span> <span class="pl-k">=</span> <span class="pl-c1">1</span> <span class="pl-k">*</span> (<span class="pl-en">CAD</span> <span class="pl-k">/</span> gal)

<span class="pl-k">val</span> <span class="pl-en">price1</span> <span class="pl-k">=</span> (barrelPrice <span class="pl-k">+</span> gallonPrice) to (<span class="pl-en">CAD</span> <span class="pl-k">/</span> gal)
<span class="pl-k">val</span> <span class="pl-en">price2</span> <span class="pl-k">=</span> (gallonPrice <span class="pl-k">+</span> barrelPrice) to (<span class="pl-en">USD</span> <span class="pl-k">/</span> (bbl of wti))

price1.value should equal(<span class="pl-c1">2.2</span> <span class="pl-k">+-</span> <span class="pl-c1">0.0000000000001</span>)
price1.measure should be(<span class="pl-en">CAD</span> <span class="pl-k">/</span> gal)

price2.value should equal(<span class="pl-c1">77.0</span> <span class="pl-k">+-</span> <span class="pl-c1">0.0000000000001</span>)
price2.measure should be(<span class="pl-en">USD</span> <span class="pl-k">/</span> (bbl of wti))</pre></div>
      </section>
      <footer>
        <p>Project maintained by <a href="https://github.com/quantarray">quantarray</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://twitter.com/michigangraham">mattgraham</a></small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-61924022-3");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>